{% extends "base_without_popup.html" %}
 <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
{% block title %}Residence Page{% endblock %}

{% block content %}
{% if user.isResidenceManager %}
<button onclick="Edit()">Edit Residence</button>
 <script language="JavaScript">
    function Edit()
    {
        window.location.href = "/residence/{{object.pk}}/edit";
    }
  </script>
{% endif %}
<h2> Residence name: {{ object.name }} </h2>
<h2> Tags:
    {% for tag in tags %}
        {{tag}}
    {% endfor %}
</h2>


{% if object.manager.all %}
    <h2> Residence managers: 
    {% for manager in object.manager.all %}    
        {{manager}}
    {% endfor %}
    </h2>        
{% endif %}
<h2> Residence adress: {{ object.location.streetNum }} {{ object.location.streetName }} {{ object.location.zipcode }} </h2>

<form>
    <button formaction="/addReview/{{object.pk}}">Write a review</button>
</form>
<h2>Review Section</h2>
<strong> <-----------------------------------------------------------------------></strong>


{% if not object.comments.all %}
    <small>No comment yet</small>
    
{% else %}
    <br>
    <!--button id = "lhbtn" onclick="ascending()">sort by low to high ratings</button>
    <button id = "hlbtn" onclick="descending()">sort by high to low ratings</button-->
    
    <a href= "{% url 'residence_info' object.pk %}"><button type = "button">default</button></a>
    <a href = "{% url 'residence_info' object.pk %}?sort=lhratings"><button type = "button">sort by low to high ratings</button></a>
    <a href = "{% url 'residence_info' object.pk %}?sort=hlratings"><button type = "button">sort by high to low ratings</button></a>
    <a href= "{% url 'residence_info' object.pk %}?sort=likes"><button type = "button">sort by likes</button></a>
    <a href= "{% url 'residence_info' object.pk %}?sort=dislikes"><button type = "button">sort by dislikes</button></a>
    
    
    <div id = "original">
    {% for comment in reviews.all %}
        <br>
        <h3>{{ comment.title }}</h3><br>
        time lived: {{ comment.time_lived }} <br>
        rent: $ {{comment.rent }} / month <br>
        {% if comment.live_again %}
            Would live again: Yes
        {% else %}
            Would live again: No
        {% endif %} <br>

        overall rating: {{ comment.rating }}  <br>
        location rating: {{ comment.location_rating }}  <br>
        quietness rating: {{ comment.quietness_rating }}  <br>
        quality rating: {{ comment.quality_rating }}  <br>

        {{ comment.content }}<br>
        {% if comment.isAnonymous and comment.reviewer != user %}
            by Anonymous User
        {% else %}
            by {{ comment.reviewer }}
        {% endif %}
        | {{ comment.publishTime }} <br>
        <br>
        <form>
            <button formaction="/changecomment/{{comment.pk}}/"> Update Comment</button>
            <button formaction="/deletecomment/{{comment.pk}}">  Delete Comment</button>
            
        </form>

        <form action = "{% url 'likeReview' object.pk %}">
            {% csrf_token %}
            <button type = "submit", name = "review_id", value = "{{ comment.id }}">Like</button>
            <strong> {{ comment.likes.count }} likes </strong>
        </form>

        <form action = "{% url 'dislikeReview' object.pk %}">
            {% csrf_token %}
            <button type = "submit", name = "review_id", value = "{{ comment.id }}">Dislike</button>
            <strong> {{ comment.dislikes.count }} Dislikes </strong>
        </form>
        <strong> <-----------------------------------------------------------------------></strong> 
    {% endfor %}
    </div>
    {% endif %}
{% endblock %}